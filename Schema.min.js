var JQB;(function(n){(function(n){var u=function(){function n(n){this.tables=[],this.parseSchemaCsv(n)}return n.prototype.table=function(n){for(var t=0;t<this.tables.length;t++)if(this.tables[t].name===n)return this.tables[t];return null},n.prototype.parseSchemaCsv=function(n){for(var e=n.split("\n"),u=null,i,s,f=0,o=e.length;f<o;f++)i=e[f].split(","),(u===null||u.name!=i[0])&&(u=new t(i[0]),this.tables.push(u)),s=i[3]!=null&&i[3].toLowerCase()[0]=="p",u.addColumn(new r(i[1],i[2],s))},n}(),t,i,r;n.Database=u,t=function(){function n(n){this.name=n,this.columns=[]}return n.prototype.singularize=function(){return this.name.match(/ies$/)?this.name.substr(0,this.name.length-3)+"y":this.name.match(/s$/)?this.name.substr(0,this.name.length-1):this.name},n.prototype.addColumn=function(n){this.columns.push(n)},n.prototype.guessForeignKeys=function(n){for(var t=[],i=0;i<n.length;i++)t=t.concat(this.guessMyForeignKeysTo(n[i])),t=t.concat(n[i].guessMyForeignKeysTo(this));return t},n.prototype.guessMyForeignKeysTo=function(n){for(var u=n.getPrimaryKey(),r,t=0;t<this.columns.length;t++)if(r=this.columns[t],r.name===n.name+"_id"||r.name===n.singularize()+"_id")return[new i(n,this,[u],[r])];return[]},n.prototype.getPrimaryKey=function(){if(this.columns.length===0)return null;for(var n=0;n<this.columns.length;n++)if(this.columns[n].isPk)return this.columns[n];return this.columns[0]},n}(),n.Table=t,i=function(){function n(n,t,i,r){this.primary=n,this.fkOwner=t,this.primaryColumns=i,this.fkColumns=r}return n}(),n.ForeignKey=i,r=function(){function n(n,t,i){this.name=n,this.datatype=t,this.isPk=i}return n.prototype.isPkOrFk=function(){return this.isPk||this.name==="id"||this.name.match(/_id/)},n}(),n.Column=r})(n.Schema||(n.Schema={}));var t=n.Schema})(JQB||(JQB={}))